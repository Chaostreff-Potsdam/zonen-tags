<!DOCTYPE html>
<html>

<head>
    <title>User Form</title>
    <!-- Include Bootstrap CSS -->
    <link rel="stylesheet" href=" {{ bootstrap_css }}">
</head>

<body>

    <div class="container text-center">
        <div class="row mb-4 mt-4">
            <h1>Geekend Tag Configurator</h1>
        </div>
        <div class="row mb-4 mt-4">
            <p>Enter your information below to configure your Geekend tag.</p>
        </div>
        <div class="mb-3">
            <img id="example" src="{{ example_image }}" alt="Example Image" style="border: 3px solid black;">
            <br>
            <label for="example">Example Image</label>
        </div>
        <!-- <div class="d-flex align-items-center justify-content-center"> -->
        <!-- </div> -->
        <div class="row">
            <form id="form">
                <div class="row justify-content-center">

                    <div class="col-sm-3 d-flex flex-column">
                        <label for="nickname" class="form-label">Nickname:</label>
                        <input type="text" class="form-control" id="nickname" name="nickname"
                            placeholder="Enter your nickname" required>
                    </div>
                    <div class="col-sm-2 d-flex flex-column">
                        <label for="pronouns" class="form-label">Pronouns:</label>
                        <input type="text" class="form-control" id="pronouns" name="pronouns"
                            placeholder="Enter your pronouns" required>
                    </div>
                    <div class="col-sm-3 d-flex flex-column">
                        <label for="macAddress" class="form-label">MAC Address:</label>
                        <input type="text" class="form-control" id="macAddress" name="macAddress"
                            placeholder="Enter your MAC address" required>
                    </div>
                    <div class="col-sm-2 d-flex flex-column">
                        <label for="font">Select a font:</label>
                        <select class="form-control" id="font" name="font">
                            <option value="ComicSans">ComicSans</option>
                            <option value="Roboto-Bold">Roboto-Bold</option>
                            <option value="VinaSans-Regular">VinaSans-Regular</option>
                            <option value="IndieFlower-Regular">IndieFlower-Regular</option>
                        </select>
                    </div>
                    <div class="col-sm-2 d-flex flex-column">
                        <label for="size">Select a Display Size:</label>
                        <select class="form-control" name="size">
                            <option value="small">small</option>
                            <option value="medium">medium</option>
                            <!-- <option value="VinaSans-Regular">VinaSans-Regular</option>
                            <option value="IndieFlower-Regular">IndieFlower-Regular</option> -->
                        </select>
                    </div>
                    <div class="col-sm-auto flex-column d-flex justify-content-end">
                        <button id="upload_button" type="button" class="btn btn-primary btn-lg">Upload</button>
                    </div>
                </div>
            </form>
        </div>
        <div class="row">
            <!-- a form to upload an image -->
            <form id="upload_image_form" enctype="multipart/form-data">
                <div class="row justify-content-center">
                    <div class="col-sm-5 d-flex flex-column">
                        <label for="file" class="form-label">Image:</label>
                        <input type="file" class="form-control" id="file" name="file" required>
                    </div>
                    <div class="col-sm-3 d-flex flex-column">
                        <label for="macAddress2" class="form-label">MAC Address:</label>
                        <input type="text" class="form-control" id="macAddress2" name="macAddress"
                            placeholder="Enter your MAC address" required>
                    </div>
                    <div class="col-sm-2 d-flex flex-column">
                        <label for="size">Select a Display Size:</label>
                        <select class="form-control" name="size">
                            <option value="small">small</option>
                            <option value="medium">medium</option>
                            <!-- <option value="VinaSans-Regular">VinaSans-Regular</option>
                            <option value="IndieFlower-Regular">IndieFlower-Regular</option> -->
                        </select>
                    </div>

                    <div class="col-sm-auto flex-column d-flex justify-content-end">
                        <button id="upload_image_button" type="button" class="btn btn-primary btn-lg">Upload</button>
                    </div>
                </div>
        </div>

        <!-- Modal -->
        <div class="modal fade" id="resultModal" tabindex="-1" role="dialog" aria-labelledby="resultModalLabel"
            aria-hidden="true">
            <div class="modal-dialog" role="document">
                <div class="modal-content">
                    <div class="modal-header">
                        <h5 class="modal-title" id="resultModalLabel">Result</h5>
                        <button type="button" class="close" data-bs-dismiss="modal" aria-label="Close">
                            <span aria-hidden="true">&times;</span>
                        </button>
                    </div>
                    <div class="modal-body">
                        <p id="resultMessage"></p>
                    </div>
                    <div class="modal-footer">
                        <button type="button" class="btn btn-secondary" data-bs-dismiss="modal">Close</button>
                    </div>
                </div>
            </div>
        </div>

        <div id="toast" class="toast" role="alert" aria-live="assertive" aria-atomic="true">
            <div class="toast-header">
                <img src="..." class="rounded mr-2" alt="...">
                <strong class="mr-auto">Bootstrap</strong>
                <small>11 mins ago</small>
                <button type="button" class="ml-2 mb-1 close" data-dismiss="toast" aria-label="Close">
                    <span aria-hidden="true">&times;</span>
                </button>
            </div>
            <div id="toastBody" class="toast-body">
            </div>
        </div>

        <!-- Include Bootstrap JavaScript -->
        <script src="{{ bootstrap_js }}"></script>
        <script src="{{ jquery_js }}"></script>
        <script>
            $('#upload_image_form').on('keyup keypress', function (e) {
                var keyCode = e.keyCode || e.which;
                if (keyCode === 13) {
                    e.preventDefault();
                    $("#upload_image_button").click();
                    return false;
                }
            });
            $('#form').on('keyup keypress', function (e) {
                var keyCode = e.keyCode || e.which;
                if (keyCode === 13) {
                    e.preventDefault();
                    $("#upload_button").click();
                    return false;
                }
            });

            function getFormData($form) {
                var unindexed_array = $form.serializeArray();
                var indexed_array = {};

                $.map(unindexed_array, function (n, i) {
                    indexed_array[n['name']] = n['value'];
                });

                return indexed_array;
            }

            $("#upload_button").on("click", function () {

                let formData = getFormData($("#form"));
                $.ajax({
                    url: "upload",
                    type: "POST",

                    success: function (data) {
                        // $("#resultMessage").text(data["message"]);
                        // $("#resultModal").modal("show");
                        $("#toastBody").text(data["message"]);
                        $("#toast").toast("show");
                        $("#example").attr("src", data["file_name"]);
                    },
                    dataType: 'json',
                    data: JSON.stringify(formData),
                    contentType: 'application/json;charset=UTF-8',
                    // Tell jQuery not to process data or worry about content-type
                    // You *must* include these options!
                    cache: false,

                    processData: false,
                });
            });

            $("#upload_image_button").on("click", function () {

                $.ajax({
                    url: "image_upload",
                    type: "POST",
                    data: new FormData($("#upload_image_form")[0]),
                    success: function (data) {
                        $("#toastBody").text(data["message"]);
                        $("#toast").toast("show");
                        $("#example").attr("src", data["file_name"]);
                    },
                    processData: false,
                    contentType: false,
                    cache: false,

                });
            });
        </script>
</body>

</html>